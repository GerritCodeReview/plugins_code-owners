{
  "comments": [
    {
      "unresolved": true,
      "key": {
        "uuid": "e9f8add3_e3f9ebc7",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 77,
      "author": {
        "id": 1148215
      },
      "writtenOn": "2024-08-13T11:46:52Z",
      "side": 1,
      "message": "Honestly, I disagree with this.\n\nI think inheritance is generally more difficult for readability. In the same way that with an optional field you need to know when is it set, you need to know that CodeOwnerConfigFileInfo can be represented by a different derived class (only I would argue it\u0027s less trivially obvious at a glance if the codepath I am looking at uses base or derived instances).\n\nI agree that it makes more sense if we expand number of fields which are only relevant for the \"user check\", but since we have only one field and no immediate plans to add more, I think this adds complexity to the code prematurely. (Even then, I think that having a something like UserCheckInfo field that groups all such field would be better for readability than inheritance).\n\nI think it would be sufficient to have \"only set if ownership is being checked in regards to a specific user\". I don\u0027t think it causes any confusion (confusion would require reader to care about the user, but to not know if they are in the context where the user is specified, which seems unlikely). Besides from the perspective of the REST API user the presence of the field has to be explained anyway\n\nI admit, that readability of inheritance is somewhat of an opinionated topic. So feel free to disagree, if you don\u0027t find my argument convincing.",
      "range": {
        "startLine": 74,
        "startChar": 16,
        "endLine": 77,
        "endChar": 31
      },
      "revId": "87184582260102d3cdf5f8fbaa8b0566798d83fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "06228631_f61231c9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 77,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2024-08-13T14:53:10Z",
      "side": 1,
      "message": "No problem, I don\u0027t feel strongly about this (I\u0027m not a fan of using inheritance here either). So I\u0027m fine with changing this, however I realise that I forgot to mention one point that made me favour the solution with the inheritance. Let me try to explain this before making any changes.\n\nThe argument that this solution avoids confusion about when this field is set is purely from a user\u0027s point of view (I agree that using inheritance doesn\u0027t make code readability better for devs). \n\nIt\u0027s important to note that CodeOwnerConfigFileInfo is a recursive type, i.e. the resolved/unresolved imports inside the CodeOwnerConfigFileInfo are represented as CodeOwnerConfigFileInfo\u0027s too. However the \u0027assigns_code_ownership_to_user\u0027 information is only available for the outer CodeOwnerConfigFileInfo and not for CodeOwnerConfigFileInfos that represent imports.\n\nE.g.:\n```\n\"code_owner_configs\": [\n{\n  \"assigns_code_ownership_to_user\": false,\n  \"project\": \"Code-Owners-Test\",\n  \"branch\": \"refs/heads/master\",\n  \"path\": \"/foo/bar/OWNERS\"\n  \"imports\": [\n    {\n      // no \"assigns_code_ownership_to_user\" field here\n      \"project\": \"Code-Owners-Test\",\n      \"branch\": \"refs/heads/master\",\n      \"path\": \"/other/OWNERS\"\n    }\n  ]\n},\n```\n\nWith the change as it is now this is CodeOwnerConfigFileWithCheckResultsInfo that contains imports as CodeOwnerConfigFileInfo, which makes it clear the \"assigns_code_ownership_to_user\" field is only set for CodeOwnerConfigFileWithCheckResultsInfo, but nor for CodeOwnerConfigFileInfo.\n\nIf we make this so that CodeOwnerConfigFileInfo contains imports as CodeOwnerConfigFileInfo, with \"assigns_code_ownership_to_user\" as an optional field, we somehow have to explain this. As I find this difficult to phrase I believe users would find it difficult to understand. E.g. \"Only set if the CodeOwnerConfigFileInfo is returned when checking code ownership via the Check Code Owner REST endpoint, but then only for CodeOwnerConfigFileInfos that represent the code owner config files in the parent folders, but not for CodeOwnerConfigFileInfos that represent imported code owner config files.\"\n\nAs an example of further information that we may include in the future, we could include global code owners that have been ignored (globalCodeOwnerSets() from PathCodeOwnersResult when ignoreGlobalCodeOwners() is true), but at this point I have no actual plan to include this information, so I can understand the argument of premature optimisation.\n\nSo yeah, what made me distinguish between CodeOwnerConfigFileInfo and CodeOwnerConfigFileWithCheckResultsInfo was mostly to avoid explaining to the user when the \"assigns_code_ownership_to_user\" field is being set (especially with the recursive type situation).\n\nThinking about this now, maybe a better API would be something like this:\n```\n\"checked_code_owner_configs\": [\n{\n  \"code_owner_config\": {\n    \"project\": \"Code-Owners-Test\",\n    \"branch\": \"refs/heads/master\",\n    \"path\": \"/foo/bar/OWNERS\"\n    \"imports\": [\n      {\n        \"project\": \"Code-Owners-Test\",\n        \"branch\": \"refs/heads/master\",\n        \"path\": \"/other/OWNERS\"\n      }\n    ]\n  },\n  \"assigns_code_ownership_to_user\": false\n},\n```\n\nBasically have CheckedCodeOwnerConfigInfo at the root which has 2 fields: \"code_owner_config\" of type CodeOwnerConfigInfo and \"assigns_code_ownership_to_user\". This way we would avoid the confusion of when \"assigns_code_ownership_to_user\" is set and also avoid using inheritance.\n\nWDYT?",
      "parentUuid": "e9f8add3_e3f9ebc7",
      "range": {
        "startLine": 74,
        "startChar": 16,
        "endLine": 77,
        "endChar": 31
      },
      "revId": "87184582260102d3cdf5f8fbaa8b0566798d83fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "d276402c_67e0cb36",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 77,
      "author": {
        "id": 1148215
      },
      "writtenOn": "2024-08-13T15:02:39Z",
      "side": 1,
      "message": "\u003e It\u0027s important to note that CodeOwnerConfigFileInfo is a recursive type, i.e. the resolved/unresolved imports inside the CodeOwnerConfigFileInfo are represented as CodeOwnerConfigFileInfo\u0027s too. However the \u0027assigns_code_ownership_to_user\u0027 information is only available for the outer CodeOwnerConfigFileInfo and not for CodeOwnerConfigFileInfos that represent imports.\n\nHm. I didn\u0027t realize this... Why do we not want to have this property set on imported Configs? If we are trying to increase clarity for debugging, I would actually like to know, which specific import ended up being responsible for assigning ownership.\n\nDo you think it makes sense to include this property for the Configs in `imports` as well?",
      "parentUuid": "06228631_f61231c9",
      "range": {
        "startLine": 74,
        "startChar": 16,
        "endLine": 77,
        "endChar": 31
      },
      "revId": "87184582260102d3cdf5f8fbaa8b0566798d83fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "57eccc65_ee32d5c3",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 77,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2024-08-13T15:32:19Z",
      "side": 1,
      "message": "Yeah, I was asking this myself too. Unfortunately this is tricky.\n\nLet\u0027s say you check the code ownership for user user@example.com and file foo/bar.md and this is the OWNERS file that is being imported:\n\n```\nother-user@example.com\nper-file *.md\u003duser@example.com\n```\n\nI guess people would expect \u0027assigns_code_ownership_to_user\u0027 to be true, since the per-file rule matches.\n\nBut if the importing code owner config file imports this code owner config via the \"file\" keyword only global code owners are imported, i.e. not the per-file rule that assigns code ownership to the user. So one could argue that in this case \u0027assigns_code_ownership_to_user\u0027 should be false. Either way it\u0027s confusing, either \u0027assigns_code_ownership_to_user\u0027 says true although it\u0027s actually not making the user a code owner (because the per-file rule that assigns the code ownership is not imported) or it says false, but without looking at the importing code owner config file this looks wrong.\n\nThere are other ways how there are dependencies between importing and imported code owner configs that influence which parts of the code owner configs are relevant and which parts are being ignored (e.g. importing a per-file rule with \"set noparent\" makes global code owners in the importing code owner config file ignored).\n\nDue to this ambiguity I\u0027m not sure that adding \u0027assigns_code_ownership_to_user\u0027 for the imported code owner config file would actually improve clarity, but maybe it would rather increase confusion.\n\nIn any case, with the data that we currently collect in PathCodeOwnersResult we cannot answer the question whether the user is a code owner due to the importing code owner config or due an imported code owner config (and due to which one). Currently finding out about this still requires looking at the involved OWNERS files manually. Collecting this data is probably possible but I guess it\u0027s more work than we would like to invest now.",
      "parentUuid": "d276402c_67e0cb36",
      "range": {
        "startLine": 74,
        "startChar": 16,
        "endLine": 77,
        "endChar": 31
      },
      "revId": "87184582260102d3cdf5f8fbaa8b0566798d83fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a0a535c3_9a25316f",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 77,
      "author": {
        "id": 1148215
      },
      "writtenOn": "2024-08-14T07:53:26Z",
      "side": 1,
      "message": "I don\u0027t want to block this much longer, so feel free to resolve. I can see that there is complexity that maybe ends up with perfect being the enemy of good. Though I do still think that inheritance is making code more complex.\n\n\u003e But if the importing code owner config file imports this code owner config via the \"file\" keyword only global code owners are imported, i.e. not the per-file rule that assigns code ownership to the user. So one could argue that in this case \u0027assigns_code_ownership_to_user\u0027 should be false. Either way it\u0027s confusing, either \u0027assigns_code_ownership_to_user\u0027 says true although it\u0027s actually not making the user a code owner (because the per-file rule that assigns the code ownership is not imported) or it says false, but without looking at the importing code owner config file this looks wrong.\n\nCan we avoid confusion, by also including \"ignore_globals\" \"ignore_per_file\" boolean flags in the output. I think then confusion is resolved, ie.\n```\nassigns_code_ownership_to_user: false // WHY?\nignore_global_rules: true // Oh, I see why?\n```",
      "parentUuid": "57eccc65_ee32d5c3",
      "range": {
        "startLine": 74,
        "startChar": 16,
        "endLine": 77,
        "endChar": 31
      },
      "revId": "87184582260102d3cdf5f8fbaa8b0566798d83fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "997b0adb_762a9e74",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 77,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2024-08-14T08:27:36Z",
      "side": 1,
      "message": "Nice idea! Including a flag telling whether global code owners are ignored is a good idea. For per-file rules it\u0027s not possible, because it\u0027s not either all or no per-file rules, but some per-file rules are taken into account while others are ignored (non-matching per file rules or per-file rules in code owner configs that are imported via the \"file\" keyword, which means only global code owners should be imported).\n\nActually to answer the why we also have the debug messages that inform about this, e.g. they tell which per-file rules are matching.\n\nI may still try out the other solution with \"checked_code_owner_configs\" which I outlined above, which would avoid using inheritance and also avoid confusion about when the assigns_code_ownership_to_user field is being set.",
      "parentUuid": "a0a535c3_9a25316f",
      "range": {
        "startLine": 74,
        "startChar": 16,
        "endLine": 77,
        "endChar": 31
      },
      "revId": "87184582260102d3cdf5f8fbaa8b0566798d83fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "a69fa15d_0e2da3d9",
        "filename": "/COMMIT_MSG",
        "patchSetId": 2
      },
      "lineNbr": 77,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2024-08-14T12:41:09Z",
      "side": 1,
      "message": "\u003e I may still try out the other solution with \"checked_code_owner_configs\" which\n\u003e I outlined above, which would avoid using inheritance and also avoid confusion \n\u003e about when the assigns_code_ownership_to_user field is being set.\n\nI\u0027m implemented this with the new patch set now. PTAL and let me know if you like it more, otherwise it\u0027s also fine to go back to this solution.\n\n\u003e Nice idea! Including a flag telling whether global code owners are ignored is\n\u003e a good idea.\n\nI\u0027ve added this in the follow-up change now:\nhttps://gerrit-review.git.corp.google.com/c/plugins/code-owners/+/435082",
      "parentUuid": "997b0adb_762a9e74",
      "range": {
        "startLine": 74,
        "startChar": 16,
        "endLine": 77,
        "endChar": 31
      },
      "revId": "87184582260102d3cdf5f8fbaa8b0566798d83fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "113e9c90_332ba055",
        "filename": "resources/Documentation/rest-api.md",
        "patchSetId": 2
      },
      "lineNbr": 947,
      "author": {
        "id": 1148215
      },
      "writtenOn": "2024-08-13T11:46:52Z",
      "side": 1,
      "message": "assigns_code_ownership_to_user",
      "range": {
        "startLine": 947,
        "startChar": 241,
        "endLine": 947,
        "endChar": 270
      },
      "fixSuggestions": [
        {
          "fixId": "f2bb08bb_092f8366",
          "description": "prompt_to_edit API",
          "replacements": [
            {
              "path": "resources/Documentation/rest-api.md",
              "range": {
                "startLine": 947,
                "startChar": 0,
                "endLine": 948,
                "endChar": 0
              },
              "replacement": "| `is_code_owner` | Whether the given email owns the specified path in the branch. True if: a) the given email is resolvable (see field `is_resolvable\u0027) and b) any code owner config file assigns codeownership to the email for the path (see `assigns_code_ownership_to_user` field of the inspected code owner configs that are return in the `code_owner_configs` field) or the email is configured as global code owner (see field `is_global_code_owner`) or the user is a fallback code owner (see field `is_fallback_code_owner`).\n"
            }
          ]
        }
      ],
      "revId": "87184582260102d3cdf5f8fbaa8b0566798d83fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "b2d6fb9e_8ea2bf84",
        "filename": "resources/Documentation/rest-api.md",
        "patchSetId": 2
      },
      "lineNbr": 947,
      "author": {
        "id": 1003935
      },
      "writtenOn": "2024-08-13T14:53:10Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "113e9c90_332ba055",
      "range": {
        "startLine": 947,
        "startChar": 241,
        "endLine": 947,
        "endChar": 270
      },
      "revId": "87184582260102d3cdf5f8fbaa8b0566798d83fb",
      "serverId": "173816e5-2b9a-37c3-8a2e-48639d4f1153"
    }
  ]
}